export { future as theme } from 'mdx-deck/themes'
import { Appear } from 'mdx-deck'
import { Split } from 'mdx-deck/layouts'
import { CodeSurfer } from "mdx-deck-code-surfer"
import vsDark from "prism-react-renderer/themes/vsDark"

# Ambitious React Applications
---
## Why React?
---
<a href="https://npm-stat.com/charts.html?package=react&package=vue&package=%40angular%2Fcore&package=ember-source&from=2016-06-01&to=2018-05-31"><img src="img/downloads-per-month.png" /></a>
---
<table>
  <tbody>
    <tr>
      <td>
        <ul style={{listStyleType: 'none'}}>
          <Appear>
            <li>"View layer"</li>
            <li>Focussed</li>
            <li>Flexible</li>
            <li>Lightweight</li>
            <li>Innovative</li>
            <li>Fatigue</li>
          </Appear>
        </ul>
      </td>
      <td>
        <h3>Framework Spectrum</h3>
        <img src="img/Framework Spectrum.png" />
      </td>
      <td>
        <ul style={{listStyleType: 'none'}}>
          <Appear>
            <li>"All the things"</li>
            <li>Opinionated</li>
            <li>Productive</li>
            <li>Bloated</li>
            <li>Stable</li>
            <li>Stagnation</li>
          </Appear>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
---
## Philosophy
---
### Ember

<Appear>
<p>Convention > Configuration</p>
</Appear>
---
### React
<Appear>
<p><code>ui = f(s)</code></p>
</Appear>
---
## Tooling
---
### Ember CLI
```bash
ember new my-new-app
cd my-new-app
ember test
ember serve
ember generate route items
```
---
### React

<table>
  <tbody>
    <tr>
      <td width="300px">
        <a style={{color: '#0af'}} href="https://github.com/facebook/create-react-app">
          <img src="img/react-js-img.png" height="100" />
          <p>create-react-app</p>
        </a>
      </td>
      <td width="300px">
        <a style={{color: '#0af'}} href="https://nextjs.org/">
          <img src="img/nextjs-white-logo.svg" height="100" />
          <p>Next.js</p>
        </a>
      </td>
      <td width="300px">
        <a style={{color: '#0af'}} href="https://www.gatsbyjs.org/">
          <img src="img/gatsby-logo.png" height="100" />
          <p>Gatsby</p>
        </a>
      </td>
    </tr>
  </tbody>
</table>
---

üöÄ Like Ember CLI, each:
<ul>
  <Appear>
  <li>installs dependencies & tooling</li>
  <li>insulates devs from low-level tooling</li>
  <li>comes with (a few) opinions (folders, etc)</li>
  <li>has commands to run & build app</li>
  </Appear>
</ul>

```notes
no sub commands for generating routes, components, etc
```
---
üìñ Emphasize docs/examples for the rest:
<ul>
  <Appear>
  <li>styling components (CSS in JS, Sass, etc)</li>
  <li>installing & using libraries</li>
  <li>writing & running tests</li>
  <li>deployment</li>
  </Appear>
</ul>
---
### [create-react-app](https://github.com/facebook/create-react-app)

<a href="https://github.com/facebook/create-react-app">
  <img src="img/react-js-img.png" height="100" />
</a>

<table cellPadding="10">
  <tbody>
    <tr><td align="left">Key Feature:</td><td align="left">official support/docs</td></tr>
    <tr><td align="left">Best Uses:</td><td align="left">learning react, simple apps</td></tr>
    <tr><td align="left">Owner:</td><td align="left">Facebook</td></tr>
  </tbody>
</table>

---
<a href="https://nextjs.org/">
  <img src="img/nextjs-white-logo.svg" height="200" />
</a>

<table cellPadding="10">
  <tbody>
    <tr><td align="left">Key Feature:</td><td align="left">SSR, route-based data fetching & code-splitting</td></tr>
    <tr><td align="left">Best Uses:</td><td align="left">data-centric apps</td></tr>
    <tr><td align="left">Owner:</td><td align="left">Zeit (Now)</td></tr>
  </tbody>
</table>

---
<a href="https://www.gatsbyjs.org/">
  <img src="img/gatsby-logo.png" height="200" />
</a>

<table cellPadding="10">
  <tbody>
    <tr><td align="left">Key Feature:</td><td align="left">static site generation, ecosystem</td></tr>
    <tr><td align="left">Best Uses:</td><td align="left">content-centric apps like blogs</td></tr>
    <tr><td align="left">Owner:</td><td align="left">Gatsby.com</td></tr>
  </tbody>
</table>

---
### Which did I choose?
<Appear>
<p>create-react-app</p>
<p>... and Next.js</p>
</Appear>
---
## Create ArcGIS App

<a href="https://create-arcgis-app.surge.sh/"><img width="852" src="img/create-arcgis-app-screenshot.png" /></a>

[create-arcgis-app](https://github.com/tomwayson/create-arcgis-app)
---
## Next ArcGIS App

<a href="https://next-arcgis-app.now.sh/"><img width="680" src="img/next-arcgis-app-screenshot.png" /></a>

[next-arcgis-app](https://github.com/tomwayson/next-arcgis-app)
---
## Architecture
---
### Ember

_Routes_ drive the application
---
Plan application as a tree of nested **routes**
```
/application
  route
  template
  /index
    controller
    template
  /items
    route
    controller
    template
```
<Appear>
<p>For cross-cutting concerns use <strong>services</strong> (i.e. <code>session</code>)</p>
</Appear>

```notes
/application
  route - set locale, rehydrate session
  template - show nav menu w/ user sign in/out
  /index
    controller - transition to items on search
    template - show search form
  /items 
    route - parse query params
    controller - respond to user paging/searching
    template - show search results

Example services:
- `session` - fetch, persist, and provide user auth & info
- `items` - execute items search (depends on session)
```
---
### React

<small style={{color: 'grey'}}>(almost)</small> Everything is a component
---
Ember|React
--|--
Router|Component
Route|Component
Controller|Component (JS)
Template|Component (JSX)
Component|Component
Helper|Component (SFC)
Service|Context or Redux
<strong>Util</strong> | <strong>Util</strong>
Ember Data|GraphQL
Initializer|index.js
---
Plan application as a tree of **components**
```
index.js
<Router>
  <App>
    <AppNav>
    <Route match="/">
      <Home>
    <Route match="/items">
      <Items>
        <ItemsLayout>
```

<Appear>
<p>For cross-cutting concerns use <a href="https://reactjs.org/docs/context.html"><code>Context</code></a></p>
</Appear>

```notes
index.js - set locale, rehydrate session
<Router>
  <App> - fetch, persist, and provide user auth & info
    <AppNav> - show nav menu w/ user sign in/out
    <Route match="/">
      <Home> - show search form & transition to items on search
    <Route match="/items">
      <Items> - parse query params & execute items search
        <ItemsLayout> - show search results & respond to user paging/searching
```
---
### Lifecycle Methods

[Ember](https://guides.emberjs.com/release/components/the-component-lifecycle/)|[React](https://reactjs.org/docs/react-component.html#the-component-lifecycle)
--|--
`init()`|`constructor()`
`didReceiveAttrs()`|`getDerivedStateFromProps()`
`willRender()`|`render()`
`didInsertElemenet()`|`componentDidMount()`
`didUpdateAttrs()`|`componentDidUpdate()`
`willDestroyElement()`|`componentWillUnmount()`
---
## Libraries
---
export default Split

<div>
<h3>Ember</h3>
<code>ember install some-addon</code>
</div>
<div>
<h3>React</h3>
<code>npm install --save some-package</code>
</div>

---

### [reactstrap](https://reactstrap.github.io/)

<p><del><code>ember install ember-bootstrap</code></del></p>

```
npm install --save bootstrap
npm install --save reactstrap

```

<Appear>
<p>

```
import 'bootstrap/dist/css/bootstrap.css';
```

</p>
</Appear>

---
### ArcGIS utils for _any_ framework

<iframe src="https://esri.github.io/arcgis-rest-js/" height="400" width="100%" />

[arcgis-rest-js](https://github.com/esri/arcgis-rest-js/)

---

<p>
  <del><code>ember install torii-provider-arcgis</code></del>
  <br /><del><code>ember install ember-arcgis-portal-services</code></del>
</p>

```
npm install --save @esri/arcgis-rest-items
npm install --save @esri/arcgis-rest-auth
npm install --save @esri/arcgis-rest-request
```
---
## Auth
---
<CodeSurfer
  theme={vsDark}
  title="Sign In (utils/session.js)"
  code={require("!raw-loader!./code/session.js")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [1] },
      { lines: [10, 22] },
      { range: [12, 16] }
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="Sign In (public/redirect.html)"
  code={require("!raw-loader!./code/redirect.html")}
  showNumbers={false}
  lang="html"
  dark={true}
  steps={[
      { range: [4, 6] },
      { range: [13, 15] }  
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="Sign In (utils/session.js)"
  code={require("!raw-loader!./code/session.js")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [17, 20] },
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="Sign In/Out (App.jsx)"
  code={require("!raw-loader!./code/App.jsx")}
  showNumbers={false}
  dark={true}
  steps={[
      { range: [22, 29] },
      { lines: [32] },
      { lines: [34] },
      { lines: [55, 60, 61, 62] },
      { lines: [77] },
      { lines: [63] },
      { lines: [37, 45] },
      { range: [39, 42] },
  ]}
/>
---
## Items
---
<CodeSurfer
  theme={vsDark}
  title="Items Route (Ember)"
  code={require("!raw-loader!./code/items.js")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [6] },
      { range: [10, 15] },
      { lines: [21] },
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="Items Component (React)"
  code={require("!raw-loader!./code/items.jsx")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [3] },
      { lines: [59, 62] },
      { lines: [61] },
      { lines: [30] },
      { lines: [32] },
      { range: [39, 42] },
      { range: [44, 48] },
      { range: [86, 88] },
  ]}
/>
---
## Maps
---
### [esri-loader](https://github.com/Esri/esri-loader)

<ul>
  <li>‚úÖ create-react-app</li>
  <li>‚úÖ Next.js</li>
  <li>‚úÖ Gatsby</li>
</ul>
---
### [@arcgis/webpack-plugin](https://github.com/Esri/arcgis-webpack-plugin)

<ul>
  <li>‚ùå create-react-app</li>
  <li>‚ùå Next.js</li>
  <li>‚ùå Gatsby</li>
</ul>
---
### @arcgis/webpack-plugin

[Roll your own](https://github.com/Esri/arcgis-webpack-plugin)

```
git init
npm init
npm i -S react react-dom 
npm i -D webpack webpack-cli webpack-dev-server 
npm i -D @arcgis/webpack-plugin
npm i -D @babel/core @babel/preset-env @babel/preset-react babel-loader babel-plugin-transform-es2015-modules-amd
```
---
### esri-loader
<p><del><code>ember install ember-esri-loader</code></del></p>

```
npm install --save esri-loader
```
---
### Map Util Code

üôå just `copy` + `paste` üéâ
---
<CodeSurfer
  theme={vsDark}
  title="Lifecycle Methods (Ember)"
  code={require("!raw-loader!./code/extents-map.js")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [15, 24, 27, 31, 34, 40] }
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="Lifecycle Methods (React)"
  code={require("!raw-loader!./code/ExtentsMap.jsx")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [21, 29, 30, 34, 36, 41] },    
      { tokens: {30: [3]} },
      { lines: [31], notes: "have to check for changes" },
      { lines: [23] },
      { tokens: {23:[3,4,5,6,7]} }
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="DOM Node (Ember)"
  code={require("!raw-loader!./code/extents-map.js")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [18] },
      { tokens: {18:[3,4,5]}, notes: 'automagically provided by Ember' },
      { lines: [6] },
  ]}
/>
---
<CodeSurfer
  theme={vsDark}
  title="DOM Node (React)"
  code={require("!raw-loader!./code/ExtentsMap.jsx")}
  showNumbers={false}
  dark={true}
  steps={[
      { lines: [43] },
      { tokens: {43:[6,7,8,9,10,11]}, notes: 'add the CSS class' },
      { tokens: {43:[12, 13, 14, 15, 16, 17, 18]}, notes: 'get a reference to the element' },
      { range: [6, 11], notes: 'Create ref in the constructor' },
  ]}
/>
---
## Tests
---
Feature|Ember|React
--|--|--
Helpers|ember-test-helpers|react-testing-library
Mocks|Sinon|Jest
Assertions|QUnit|Jest
Framework|QUnit|Jest
Runner|Testem|Jest

[Jest](https://jestjs.io/) - [react-testing-library](https://testing-library.com/react)

---
## Deployment
---
<p><del><code>ember install ember-cli-surge</code></del></p>

Just follow [create-react-app deployment guide](https://facebook.github.io/create-react-app/docs/deployment#surge-https-surgesh)

<Appear>
<div>

```
  "predeploy": "yarn run build && mv build/index.html build/200.html",
  "deploy": "surge ./build create-arcgis-app.surge.sh",
```

</div>
</Appear>
---
## Conclusion
---
<img src="img/esri.png" height="160" />
<img src="img/Heart_corazon.svg" height="160" />
<img src="img/Framework Spectrum.png" />
---
# Questions?
